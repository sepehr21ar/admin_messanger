<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: #e5e7eb;
      padding: 40px;
    }
    input, button {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      border-radius: 6px;
      border: none;
    }
    button {
      background: #2563eb;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #1d4ed8;
    }
    .box {
      background: #020617;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .error {
      color: #ef4444;
    }
    .success {
      color: #22c55e;
    }
  </style>
</head>
<body>

<h1>üîê Admin Panel</h1>

<!-- ================= TOKEN ================= -->
<div class="box">
  <h3>Access Token</h3>
  <input id="token" placeholder="Paste admin access token here" />
</div>

<!-- ================= USERS ================= -->
<div class="box">
  <h3>üë• Users List</h3>
  <button onclick="loadUsers()">Load Users</button>
  <ul id="users"></ul>
</div>

<!-- ================= SEND MESSAGE ================= -->
<div class="box">
  <h3>‚úâÔ∏è Send Message</h3>
  <input id="userId" placeholder="User ID" />
  <input id="message" placeholder="Message" />
  <button onclick="sendMessage()">Send</button>
  <p id="result"></p>
</div>

<script>
  const API_URL = "http://localhost:8000"; // FastAPI URL

  function getHeaders() {
    const token = document.getElementById("token").value;
    return {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    };
  }

  // ================= LOAD USERS =================
  async function loadUsers() {
    const usersEl = document.getElementById("users");
    usersEl.innerHTML = "";

    try {
      const res = await fetch(API_URL + "/admin/users", {
        headers: getHeaders()
      });

      if (!res.ok) throw new Error("Unauthorized or forbidden");

      const users = await res.json();
      users.forEach(u => {
        const li = document.createElement("li");
        li.innerText = `ID: ${u.id} | ${u.username} | ${u.role}`;
        usersEl.appendChild(li);
      });

    } catch (err) {
      usersEl.innerHTML = `<li class="error">Error loading users</li>`;
    }
  }

  // ================= SEND MESSAGE =================
  async function sendMessage() {
    const userId = document.getElementById("userId").value;
    const message = document.getElementById("message").value;
    const result = document.getElementById("result");

    result.innerText = "";

    try {
      const res = await fetch(API_URL + "/admin/send-message", {
        method: "POST",
        headers: getHeaders(),
        body: JSON.stringify({
          user_id: userId,
          message: message
        })
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.detail || "Send failed");
      }

      result.innerText = "‚úÖ Message sent successfully";
      result.className = "success";

    } catch (err) {
      result.innerText = "‚ùå " + err.message;
      result.className = "error";
    }
  }
</script>

</body>
</html>
