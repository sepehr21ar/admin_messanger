<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ØµÙ†Ø¯ÙˆÙ‚ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</title>
<style>
  body {
    font-family: Arial;
    padding: 20px;
    direction: rtl;
    background: #f5f5f5;
  }
  h2 { color: #333; }
  button {
    padding: 8px 12px;
    margin: 5px 0;
    background: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover { background: #45a049; }
  ul { list-style: none; padding: 0; }
  li {
    background: white;
    margin: 5px 0;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
  }
  li.unread { font-weight: bold; }
  .message-box {
    background: white;
    padding: 15px;
    margin-top: 15px;
    border-radius: 5px;
    display: none;
  }
</style>
</head>
<body>

<h2>ğŸ“¥ ØµÙ†Ø¯ÙˆÙ‚ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h2>
<button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
<button onclick="loadInbox()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>

<ul id="inbox"></ul>

<div id="message" class="message-box"></div>

<script src="./common.js"></script>
<script>
if (!parseToken()) logout();

async function loadInbox() {
  const res = await fetch(API_URL + "/messages/inbox", {
    headers: authHeaders()
  });

  const list = document.getElementById("inbox");
  list.innerHTML = "";

  const messages = await res.json();

  messages.forEach(m => {
    const li = document.createElement("li");
    li.textContent = `${m.title} â€” Ø§Ø²: ${m.sender}`;
    if (!m.is_read) li.classList.add("unread");

    li.onclick = () => openMessage(m.id, li);
    list.appendChild(li);
  });
}

async function openMessage(id, li) {
  const res = await fetch(API_URL + `/messages/${id}`, {
    headers: authHeaders()
  });
  const m = await res.json();

  const box = document.getElementById("message");
  box.style.display = "block";
  box.innerHTML = `
    <h3>${m.title}</h3>
    <p><b>ÙØ±Ø³ØªÙ†Ø¯Ù‡:</b> ${m.sender}</p>
    <p>${m.content}</p>
  `;

  await fetch(API_URL + `/messages/${id}/read`, {
    method: "POST",
    headers: authHeaders()
  });

  li.classList.remove("unread");
}

loadInbox();
</script>
</body>
</html>
